---
title: "If home field advantage exists, how much of an impact does it have on winning the world series?"
author: "Xiaohe (Marina) Yue"
output:
  html_document:
    code_folding: hide
    theme: cosmo
    toc: yes
    toc_depth: 5
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '5'
editor_options:
  chunk_output_type: inline
---

# Background Introduction

The home field advantage is the edge which a team may have when playing a game at its home stadium. For example, it is the edge the Braves may have over the Yankees when the head-to-head match-up is in Atlanta. It is the advantage the Yankees may have when the head-to-head match-up is in New York.

The World Series is a first-to-4-wins match-up between the champions of the American and National Leagues of Major League Baseball. In this assignment, you are going to use simulation and analytic methods to compare the probability of winning the World Series with and without home field advantage.




# Setup

Suppose that the Braves and the Yankees are teams competing in the World Series. We have two possible schedules for each game of the series. (NYC = New York City, ATL = Atlanta)

Let PB be the probability that the Braves win a single head-to-head match-up with the Yankees, under the assumption that home field advantage doesn’t exist. Let PBH denote the probability that the Braves win a single head-to-head match-up with the Yankees as the home team (H for home). Let PBA denote the probability that the Braves win a single head-to-head match-up with the away team (A for away).


Game Location  |   No advantage   |    Advantage
---------------|------------------|-----------------------
ATL	           |   PB	            |    PBH = PB*1.1
NYC	           |   PB	            |    PBA = 1−(1−PB)*1.1




# Questions
***

_1. Compute analytically the probability that the Braves win the world series when the sequence of game locations is {NYC, NYC, ATL, ATL, ATL, NYC, NYC}. Calculate the probability with and without home field advantage when PB=0.55. What is the difference in probabilities?_

We have p as a new column standing for probability with home field advantage, and we have p_no_a as a new column standing for probability without home field advantage. Compared to the other one, we can see that when there is no home field advantage, the winning probability stays the same when the last win hits on the same game. From the overall outcome, since 0.608 is greater than 0.604, we could see that the winning probability is slightly higher when there is no home field advantage for this specific sequence of game locations. The difference between prob is about 0.026.
```{r include=FALSE}
# Get all the possible outcomes
require(dplyr)
require(data.table)
library(ggplot2)
library(ie2misc)
library(readr)
apo1 <- fread("D:/Fall 2019/Prob 5620/Probability-and-Inference-Portfolio-Yue-Marina/04-world-series-home-field/all-possible-world-series-outcomes.csv")
```

```{r}
hfa_function<-function(series_start=1,pb = 0.55,advantage_multiplier=1.1, apo=apo1){


# Home Field indicator
if (series_start ==1){
  hfi <- c(1,1,0,0,0,1,1)
}else{
  hfi <- 1-c(1,1,0,0,0,1,1)
}

# P_B, with home field advantage
pbh <- pb*advantage_multiplier
pba <- 1 - (1 - pb)*advantage_multiplier

if(pbh >1 | pbh <0|pba>1|pba<0){
  stop("Try again")
}


# Calculate the probability of each possible outcome
apo[, p := NA_real_] # Initialize new column in apo to store prob
for(i in 1:nrow(apo)){
  prob_game <- rep(1, 7)
  for(j in 1:7){
    p_win <- ifelse(hfi[j], pbh, pba)
    prob_game[j] <- case_when(
        apo[i,j,with=FALSE] == "W" ~ p_win
      , apo[i,j,with=FALSE] == "L" ~ 1 - p_win
      , TRUE ~ 1
    )
  }
  apo[i, p := prod(prob_game)] # Data.table syntax
}

# Sanity check: does sum(p) == 1?
# apo[, sum(p)] # This is data.table notation

# Probability of overall World Series outcomes
copy(apo[, sum(p), overall_outcome])

}
hfa_function()
hfa_function(advantage_multiplier=1)

```


_2. Calculate the same probabilities as the previous question by simulation._

Now, we simulate the process that we have done for the first quetion in order to mimic the reality. After the repetition, we see that the same probability for the situation when there is home field advantage is about 0.028, and the same probability for the situation when there is no home field advantage is about 0.026. The difference is about 0.017. It is actually smaller than our probability in difference that from the first question. According to the simulation, there is no obvious difference between these two conditions.
```{r}
# When there is home field advantage
# hfi <- c(0,0,1,1,1,0,0) 
#{NYC, NYC, ATL, ATL, ATL, NYC, NYC}

# P_B, with home field advantage
# pb <- 0.55
# advantage_multiplier <- 1.1 # Set = 1 for no advantage
# pbh <- 0.55*advantage_multiplier
# pba <- 1 - (1 - 0.55)*advantage_multiplier
set.seed(4321)

hfap<- rep(NA,10000)
for(i in 1:10000){
  win_count <- 0
  lose_count <- 0
  pb_rate <- 1
  counter <- 1
  while(win_count<4 && lose_count<4 ){
    
    win_rate <- 0
    if(counter == 3 || counter == 4 || counter == 5){
      win_rate = 0.55 * 1.1
    }else{
      win_rate = 1 - (1 - 0.55) * 1.1
    }
    counter = counter + 1
    
    random <- sample(1:1000,1)
    
      if(random<=(win_rate * 1000)){
        pb_rate = pb_rate * win_rate
        win_count = win_count+1
      }
      else{
        pb_rate = pb_rate * (1 - win_rate)
        lose_count = lose_count+1
      }
  }
  hfap[i]=pb_rate
}
(mean_hfap <- mean(hfap))
  
```


```{r}
# when there is no home field advantage
set.seed(4321)

nhfap <- rep(NA,10000)
for(i in 1:10000){
  win_count <- 0
  lose_count <- 0
  pb_rate <- 1
  while(win_count<4 && lose_count<4 ){
    random <- sample(1:100,1)
    if(random<=55){
      pb_rate = pb_rate*0.55
      win_count = win_count+1
    }
    else{
      pb_rate = pb_rate*0.45
      lose_count = lose_count+1
    }
   
  }
  nhfap[i]=pb_rate
}
(mean_nhfap <- mean(nhfap))
  
mean_hfap - mean_nhfap
```



_3. What is the absolute and relative error for your simulation in the previous question?_

Now, we try to test the simulation errors that both on absolute and relative. According to what we know from the blog of "Monte Carlo Simulation Error" [link](https://github.com/marinayxh/Probability-and-Inference-Portfolio-Yue-Marina-/tree/master/02-monte-carlo-error), we could easily get these two types of errors. The absolute error is 0.0017 and the relative error here is 0.9814. A high relative error of 0.9814 means that the approximation is correct to within ninety eight part in one hundred, regardless of the size of the actual value, which shows that our simulation is fine. 
```{r}
# Absolute error
# hfap, measurement
# nhfap, true value
absolute_error <- rep(NA,10000)
for(i in 1:10000){
  absolute_error[i] <- hfap[i]-nhfap[i]
}
(mean(absolute_error))
```
```{r}
# Relative error
# hfap, measurement
# nhfap, true value
relative_error <- rep(NA,10000)
for(i in 1:10000){
  relative_error[i] <- (hfap[i]-nhfap[i])/nhfap[i]
}
(mean(relative_error))
```