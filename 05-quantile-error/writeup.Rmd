---
title: "Which quantiles of a continuous distribution can one estimate with more precision?"
date: "9/18/2019"
author: "Xiaohe (Marina) Yue"
output:
  html_document: 
    code_folding: hide
    theme: cosmo
    toc: yes
    toc_depth: 5
    toc_float: true
editor_options: 
  chunk_output_type: inline
---


```{r}
# Setup
library(ggplot2)
library(dplyr)
```


## Common Requirement for all the distribution below
1. The sampling distribution for the quantiles is generated by repeatedly calculating the quantiles from random samples of size N. In this assignment let N=200. Calculate the length of the middle 95% of the sampling distribution by calculating the difference between 2.5% and 97.5% percentiles of the sampling distribution. Your empirical sampling distribution should be at least 5000 draws.
2. The x-axis is a transformation of the x-values in the previous figure. You will calculate the density (relative likelihood) corresponding to the pt**h quantiles from the previous figure.

## Distributions

### Distribution 1: The Standard Normal Distribution

#### Figure of the Length of middle 95% of sampling distribution
Here we could see that between 0.4 and 0.6 quantile, the middle 95% sampling distribution hits the lowest point, so the overall graph is concave up. 
```{r}
p <- seq(0.05, 0.95, by = 0.05)

quantiles_snd <- matrix(NA,nrow = 5000,ncol = 19)

for (i in 1:5000) {
  snd <- rnorm(200)
  for (j in 1:19) {
    quantiles_snd[i,j] <- quantile(snd,0.05*j)   #[i][j]: for list (can be 3D or 4D), [i,j]: for matrix and data frame
    j <- j+1
  }
  i<-i+1
}

mid.lengths <- rep(NA,19)

for (i in 1:19) {
  mid.lengths[i] <- quantile(quantiles_snd[,i],0.975)-quantile(quantiles_snd[,i],0.025)
}

plot(p,mid.lengths, xlab = "pth quantile", ylab = "Length", main = "Length of middle 95% of sampling distribution", type = "p")

```

#### Figure of the length of the middle 95% of the sampling distribution by density
Here we could see that the overall distribution is showing a negative relationship between the two variables, and there are two points for each quantile.
```{r}
# Requirement 2
plot(dnorm(qnorm(p)),mid.lengths, xlab = "Density", ylab = "Length", main = "Length of the middle 95% of the sampling distribution by density", type = "p")

```



### Distribution 2: The exponential distribution with rate = 1.

#### Figure of the Length of middle 95% of sampling distribution
Here we could see for the exponential distribution (with rate = 1), the middle 95% sampling distribution shows an increasing exponential graph. 
```{r}
# Requirement 1
quantiles_ed <- matrix(NA,nrow = 5000,ncol = 19)

for (i in 1:5000) {
  ed <- rexp(200, rate = 1)
  for (j in 1:19) {
    quantiles_ed[i,j] <- quantile(ed,0.05*j)  
    j <- j+1
  }
  i<-i+1
}

ed.mid.lengths <- rep(NA,19)

for (i in 1:19) {
  ed.mid.lengths[i] <- quantile(quantiles_ed[,i],0.975)-quantile(quantiles_ed[,i],0.025)
}

plot(p,ed.mid.lengths, xlab = "pth quantile", ylab = "Length", main = "Length of middle 95% of sampling distribution", type = "p")
```

#### Figure of the length of the middle 95% of the sampling distribution by density
Here we could see that there are two points for each density.
```{r}
# Requirement 2
plot(dnorm(qnorm(p)),ed.mid.lengths, xlab = "Density", ylab = "Length", main = "Length of the middle 95% of the sampling distribution by density", type = "p")
```



### Distribution 3: Mixture distribution I (Given the following code)
rf3 <- function(N){
  G <- sample(0:2, N, replace = TRUE, prob = c(5,3,2))
  (G==0)*rnorm(N) + (G==1)*rnorm(N,4) + (G==2)*rnorm(N,-4,2)
}

pf3 <- function(x){
  .5*pnorm(x) + .3*pnorm(x,4) + .2*pnorm(x,-4,2)
}

df3 <- function(x){
  .5*dnorm(x) + .3*dnorm(x,4) + .2*dnorm(x,-4,2)
}

#### Figure of the Length of middle 95% of sampling distribution
Here we could see for this mixture distribution, it has binomial distribution graph, and there are two peaks when probability is about 0.2 and 0.7.The graph for quantile has shown the same trend.
```{r}
# Requirement 1

rf3 <- function(N){
  G <- sample(0:2, N, replace = TRUE, prob = c(5,3,2))
  (G==0)*rnorm(N) + (G==1)*rnorm(N,4) + (G==2)*rnorm(N,-4,2)
}

pf3 <- function(x){
  .5*pnorm(x) + .3*pnorm(x,4) + .2*pnorm(x,-4,2)
}

df3 <- function(x){
  .5*dnorm(x) + .3*dnorm(x,4) + .2*dnorm(x,-4,2)
}


roots<-rep(NA, 19)

quantiles_mix3 <- matrix(NA,nrow = 5000,ncol = 19)

for (i in 1:5000) {
  mix3 <- rf3(200)
  for (j in 1:19) {
    quantiles_mix3[i,j] <- quantile(mix3,0.05*j)
    j <- j+1
  }
  i<-i+1
}

mix3.mid.lengths <- rep(NA,19)

for (i in 1:19) {
  mix3.mid.lengths[i] <- quantile(quantiles_mix3[,i],0.975)-quantile(quantiles_mix3[,i],0.025)
}



for(i in 1:length(p)){
  pnew<-function(q){
  pf3(q)-p[i]
}

roots[i]<-uniroot(pnew, c(-100,100))[[1]]
}

# Prob 
plot(p, mix3.mid.lengths, xlab = "Probability", ylab = "Length", main = "Length of middle 95% of sampling distribution by probability", type = "p")

# Quant
plot(roots, mix3.mid.lengths, xlab = "pth quantile", ylab = "Length", main = "Length of middle 95% of sampling distribution", type = "p")
```

#### Figure of the length of the middle 95% of the sampling distribution by density
Here we could see that the overall trend is going down between these two variables.
```{r}
# Requirement 2
#Density
plot(df3(roots),mix3.mid.lengths, xlab = "Density", ylab = "Length", main = "Length of the middle 95% of the sampling distribution by density", type = "p")
```



### Distribution 4: Mixture distribution II (Given the following code)
rf4 <- function(N){
  G <- sample(0:1, N, replace = TRUE)
  (G==0)*rbeta(N,5,1) + (G==1)*rbeta(N,1,5)
}

#### Figure of the Length of middle 95% of sampling distribution
Here we could see for this mixture distribution, it has a normal distribution sampling.
```{r}
# Requirement 1

rf4 <- function(N){
  G <- sample(0:1, N, replace = TRUE)
  (G==0)*rbeta(N,5,1) + (G==1)*rbeta(N,1,5)
}


roots_4<-rep(NA, 19)

quantiles_mix4 <- matrix(NA,nrow = 5000,ncol = 19)

for (i in 1:5000) {
  mix4 <- rf4(200)
  for (j in 1:19) {
    quantiles_mix4[i,j] <- quantile(mix4,0.05*j)
    j <- j+1
  }
  i<-i+1
}

mix4.mid.lengths <- rep(NA,19)

for (i in 1:19) {
  mix4.mid.lengths[i] <- quantile(quantiles_mix4[,i],0.975)-quantile(quantiles_mix4[,i],0.025)
}


# Quant
plot(p, mix4.mid.lengths, xlab = "pth quantile", ylab = "Length", main = "Length of middle 95% of sampling distribution", type = "p")
```

#### Figure of the length of the middle 95% of the sampling distribution by density
Here we could see that the overall trend is going up between these two variables, and there are about two points under one x variable.
```{r}
# Requirement 2
#Density
plot(dnorm(qnorm(p)),mix4.mid.lengths, xlab = "Density", ylab = "Length", main = "Length of the middle 95% of the sampling distribution by density", type = "p")
```



## Questions
1. Which quantiles have more precision? less precision?
2. When does the median have the tightest sampling distribution?
3. Select a distribution and create a figure similar to the first one above, adding additional lines for N=400, 800, 1600. Explain how the information in the figure might be used when planning data collection and data analysis.

Normal Standard Distribution has been used for this one:
```{r}

size <- function(N){
  quantiles_diff_size <- matrix(NA,nrow = 5000,ncol = 19)

for (i in 1:5000) {
  snd_diff_size <- rnorm(N)
  for (j in 1:19) {
    quantiles_diff_size[i,j] <- quantile(snd_diff_size,0.05*j)   
    j <- j+1
  }
  i<-i+1
}

  
mid.lengths_diff_size <- rep(NA,19)

for (i in 1:19) {
  mid.lengths_diff_size[i] <- quantile(quantiles_diff_size[,i],0.975)-quantile(quantiles_diff_size[,i],0.025)
}
return(mid.lengths_diff_size)
}

set <- matrix(c(size(400),size(800),size(1600)),nrow = length(size(400)))

matplot(set, type = "l",ylim = c(),xlab = "Pth quantile",ylab = "Length", main = "Length of the middle 95% of the normal sampling distribution by different sample size")

```

